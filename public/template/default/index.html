<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Cable-login</title>
    <script src="{$Think.Config.template.view_path}assets/js/vue.js"></script>
    <link rel="stylesheet" href="{$Think.Config.template.view_path}assets/css/antd.min.css">
    <script src="{$Think.Config.template.view_path}assets/js/axios.min.js"></script>
    <script src="{$Think.Config.template.view_path}assets/js/antd.min.js"></script>
</head>
<body>
 <div id="app">
     <div class="login-card">
         <div align="middle">
             <h1>log in Cable</h1>
             <p>welcome</p>
         </div>
         <a-form :form="form" @submit="handleSubmit">
             <a-form-item label="" :label-col="{span: 5}" :wrapper-col="{ span: 24 }" :validate-status="email_valid" :help="valid_text">
                 <a-input v-decorator="['username',{rules: [{ required: true, message: '请输入用户名!' }]}]" />
                 <a-icon slot="prefix" type="user" style="color: rgba(0,0,0,.25)"/>
             </a-form-item>
             <a-form-item label="" :label-col="{span: 5}" :wrapper-col="{ span: 24 }">
                 <a-input v-decorator="['password',{rules: [{ required: true, message: '请输入密码!' }]}] " type="password"/>
                 <a-icon slot="prefix" type="lock" style="color: rgba(0,0,0,.25)"/>
             </a-form-item>
             <a-form-item :wrapper-col="{ span: 24, offset: 0 }">
                 <a-button type="primary" html-type="submit">
                     登录
                 </a-button>
             </a-form-item>
         </a-form>
     </div>

 </div>
</body>
<script>
    var app = new Vue({
        el: "#app",
        data() {
            return {
                login_status: 0,
                form: null,
                email_valid: null,
                valid_text: null
            }
        },
        //初始化
        mounted() {
            this.form = this.$form.createForm(this);
        },
        //方法
        methods: {
            handleSubmit(e) {
                e.preventDefault();
                //错误验证
                this.form.validateFields((err, values) => {
                    console.log(values);
                    if (!err) { //无填写错误
                        this.email_valid = 'validating';
                        var formData = new FormData();
                        formData.append('username', values['username']);
                        formData.append('password', values['password']);
                        console.log(formData);
                        axios.post('/member/user/login', {
                            'username': values['username'],
                            'password': values['password']
                        })
                            .then(function (response) {
                                console.log(response.data.status);
                                if (response.data.status == 1) {
                                    app.email_valid = 'success';
                                    app.valid_text = null;
                                    window.location.href = '/member/account';
                                } else {
                                    console.log("登录失败");
                                    app.email_valid = 'error';
                                    app.valid_text = response.data.messages;
                                }
                            })
                            .catch(function (error) {
                                console.log(error);
                            });
                    } else {
                        this.email_valid = 'warning';
                        this.valid_text = 'Incorrect email or password';
                    }
                });
            },
        },
    })
</script>
<style>
    .login-card {
        padding: 50px;
        width: 500px;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%,-50%);
        box-shadow: 0px 3px 7px rgba(163, 163, 163, 0.43);
    }
</style>
</html>